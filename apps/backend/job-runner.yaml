apiVersion: batch/v1
kind: Job
metadata:
  name: runner
  namespace: default
spec:
  template:
    metadata:
      labels:
        app: GLADOS
    spec:
      restartPolicy: Never 
      shareProcessNamespace: true
      
      containers:
      - name: datahandler
        image: datahandler:latest
        command: []
        volumeMounts:
        - name: shared-data
          mountPath: /data
        - name: signals
          mountPath: /signals
        env:
        - name: JOB_ID
          value: unused
        - name: MONGODB_PORT
          valueFrom:
            secretKeyRef:
              name: secret-env
              key: MONGODB_PORT
        - name: BACKEND_PORT
          valueFrom:
            secretKeyRef:
              name: secret-env
              key: BACKEND_PORT
        - name: GMAIL_CREDS
          valueFrom:
            secretKeyRef:
              name: secret-env
              key: GMAIL_CREDS
        - name: SIGNALS_PATH
          value: "/signals"
        
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
    
      - name: runner
        image: runner:latest
        imagePullPolicy: Never
        command: []
        volumeMounts:
        - name: shared-data
          mountPath: /data
        - name: signals
          mountPath: /signals
        env:
        - name: MONGODB_PORT
          valueFrom:
            secretKeyRef:
              name: secret-env
              key: MONGODB_PORT
        - name: BACKEND_PORT
          valueFrom:
            secretKeyRef:
              name: secret-env
              key: BACKEND_PORT
        - name: GMAIL_CREDS
          valueFrom:
            secretKeyRef:
              name: secret-env
              key: GMAIL_CREDS
        - name: SIGNALS_PATH
          value: "/signals"
        resources:
          requests:
            memory: "128Mi"
            cpu: "200m"
          limits:
            memory: "256Mi"
            cpu: "500m"
      
      volumes: 
      - name: shared-data
        emptyDir:
          sizeLimit: 500Mi
      - name: signals 
        emptyDir: {}
  backoffLimit: 4
  ttlSecondsAfterFinished: 60
